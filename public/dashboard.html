<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard - VITConnect</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="bg-decoration"></div>
    <nav class="navbar">
        <div class="container nav-container">
            <a href="/" class="logo">VITConnect</a>
            <ul class="nav-links">
                <!-- Populated by main.js -->
            </ul>
        </div>
    </nav>

    <div class="container" style="padding: 4rem 0;">
        <h1 class="section-title">My Registrations</h1>
        <div id="registration-list" class="grid-3">
             <div style="color: var(--text-secondary);">Loading...</div>
        </div>
    </div>

    <!-- Same script to load registrations -->
    <script src="/js/main.js"></script>
    <script>
        async function initPage() {
            if (!user) {
                window.location.href = '/login.html';
                return;
            }
             if (user.role === 'admin') {
                window.location.href = '/admin/dashboard.html';
                return;
            }
            loadRegistrations();
        }

        async function loadRegistrations() {
            try {
                const res = await fetch('/api/events/my/registrations');
                if (!res.ok) {
                    const errText = await res.text();
                    console.error('Fetch error:', errText);
                    throw new Error('Failed to fetch: ' + errText);
                }
                const registrations = await res.json();
                console.log('Frontend fetched registrations:', registrations);
                renderRegistrations(registrations);
            } catch (error) {
                console.error(error);
                document.getElementById('registration-list').innerHTML = '<p>No registrations found or error loading.</p>';
            }
        }

        function renderRegistrations(regs) {
            const container = document.getElementById('registration-list');
            if (regs.length === 0) {
                container.innerHTML = '<p>You have not registered for any events yet.</p>';
                return;
            }

            container.innerHTML = regs.map(reg => {
                if (!reg.event) return ''; // Skip orphaned registrations
                return `
                <div class="card fade-in-up">
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem;">${reg.event.title}</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">
                        üìÖ ${new Date(reg.event.date).toLocaleDateString()}<br>
                        üìç ${reg.event.venue}
                    </p>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                        <span style="background: var(--success); color: white; padding: 0.2rem 0.6rem; border-radius: 99px; font-size: 0.8rem; font-weight: 500;">Registered</span>
                        <span style="color: var(--text-secondary); font-size: 0.8rem; float: right; margin-top: 0.1rem;">On: ${new Date(reg.registrationDate).toLocaleDateString()}</span>
                    </div>
                </div>
            `}).join('');
        }
    </script>
</body>
</html>
